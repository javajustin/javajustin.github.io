
<html>
    <head>
<!-- load the amCharts base library -->
<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
<!-- in this case, we only need bar charts, so we'll load the appropriate amCharts script -->
<script src="https://www.amcharts.com/lib/3/serial.js"></script>
<!-- load the arcgis-rest-js scripts -->
<script src="https://unpkg.com/@esri/arcgis-rest-request"></script>
<script src="https://unpkg.com/@esri/arcgis-rest-feature-layer"></script>
<!-- optionally load an amcharts theme; cedar provides a calcite theme -->
<script src="https://unpkg.com/@esri/cedar/dist/umd/themes/amCharts/calcite.js"></script>
<!-- load cedar -->
<script src="https://unpkg.com/@esri/cedar/dist/umd/cedar.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-dateFormat/1.0/jquery.dateFormat.min.js"></script>


<style>
    #chart { height: 500px; width: 800px; }
    h1 {font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
        text-align: center;
    }
</style>

<script>
var definition = {
    "type": "bar",
    "datasets": [
      {
        "url": "https://services1.arcgis.com/CY1LXxl9zlJeBuRZ/arcgis/rest/services/Florida_COVID_19_Cases_by_Day_For_Time_Series/FeatureServer/0",
        "name": "COVIDCases",
        "query": {
          "where": "County='Okaloosa'",
          "orderByFields": "Date"
        }
      }
    ],
    "series": [
      {
        "category": {"field": "Date", "label": "Date"},
        "value": {"field": "FREQUENCY", "label": "New Cases"},
        "source": "COVIDCases"
      }
    ]
  };
  
  var cedarChart = new cedar.Chart("chart", definition);
  
  //cedarChart.dateFormatter = new AmCharts.DateFormat("yyyy-MM-dd");
  //#chart > div > div > svg > g:nth-child(15) > g:nth-child(1) > text:nth-child(10) > tspan
  //document.querySelector("#chart > div > div > svg > g:nth-child(15) > g:nth-child(1) > text:nth-child(10) > tspan")
  // /html/body/div/div/div/svg/g[14]/g[1]/text[10]/tspan
  // //*[@id="chart"]/div/div/svg/g[14]/g[1]/text[10]/tspan
  ///html/body/div/div/div/svg/g[14]/g[1]/text[1]/tspan
  
  ///html/body/div/div/div/svg/g[14]/g[2]/text[5]/tspan

  cedarChart.show();

  var existCondition = setInterval(function() {
        if ($('#chart > div > div > svg').length) {
            clearInterval(existCondition);

            $("#chart > div > div > svg > g:nth-child(15) > g:nth-child(1) > text > tspan").each(function() {
                    unformatedDate = $(this).text();                            
                    $(this).text($.format.date(new Date(Number(unformatedDate)), "MM/dd/yyyy"));
                });

                $("#chart > div > div > svg > g:nth-child(15) > g:nth-child(1) > text:nth-child(12) > tspan").text("Date");

                // $("#chart > div > div > svg > g:nth-child(8) > g > g > g").each(function() {
                //     strArray = this.ariaLabel.split(' ');
                //     formatedDate = $.format.date(new Date(Number(strArray[2])), "MM/dd/yyyy");
                //     //console.log(strArray[0]+' '+strArray[1]+' '+ formatedDate + ' '+ strArray[3] );
                //     this.ariaLabel = [0]+' '+strArray[1]+' '+ formatedDate + ' '+ strArray[3] ;
                // })

                // $("#amcharts-balloon-div > div > div[0]").each(function() {

                // }

                //document.querySelector("#chart > div > div > div > div > div:nth-child(1)")

                //amcharts-balloon-div

                // $("#chart > div > div > svg > g:nth-child(8) > g > g > g:nth-child(1)[aria-label]").attr("poop");
        }
    }, 50); // check every 50ms

  
  </script>
</head>
<body>
  <H1>Okaloosa County new COVID cases per day</H1>

<div id="chart"></div> 
</body>
</html>